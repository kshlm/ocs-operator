apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  annotations:
    alm-examples: |
      [
          {
              "apiVersion": "ocs.openshift.io/v1alpha1",
              "kind": "StorageCluster",
              "metadata": {
                  "name": "example-storagecluster",
                  "namespace": "openshift-storage"
              },
              "spec": {
                  "manageNodes": false
              }{{if .Converged}}
          },
          {
              "apiVersion": "ceph.rook.io/v1",
              "kind": "CephCluster",
              "metadata": {
                  "name": "my-rook-ceph",
                  "namespace": "my-rook-ceph"
              },
              "spec": {
                  "cephVersion": {
                      "image": "ceph/ceph:v14.2.1-20190430"
                  },
                  "dataDirHostPath": "/var/lib/rook",
                  "mon": {
                      "count": 3
                  },
                  "dashboard": {
                      "enabled": true
                  },
                  "network": {
                      "hostNetwork": false
                  },
                  "rbdMirroring": {
                      "workers": 0
                  },
                  "storage": {
                      "useAllNodes": true,
                      "useAllDevices": true
                  }
              }
          },
          {
              "apiVersion": "ceph.rook.io/v1",
              "kind": "CephBlockPool",
              "metadata": {
                  "name": "replicapool",
                  "namespace": "my-rook-ceph"
              },
              "spec": {
                  "failureDomain": "host",
                  "replicated": {
                      "size": 3
                  },
                  "annotations": null
              }
          },
          {
              "apiVersion": "ceph.rook.io/v1",
              "kind": "CephObjectStore",
              "metadata": {
                  "name": "my-store",
                  "namespace": "my-rook-ceph"
              },
              "spec": {
                  "metadataPool": {
                      "failureDomain": "host",
                      "replicated": {
                          "size": 3
                      }
                  },
                  "dataPool": {
                      "failureDomain": "host",
                      "replicated": {
                          "size": 3
                      }
                  },
                  "gateway": {
                      "type": "s3",
                      "sslCertificateRef": null,
                      "port": 8080,
                      "securePort": null,
                      "instances": 1,
                      "allNodes": false,
                      "placement": null,
                      "annotations": null,
                      "resources": null
                  }
              }
          },
          {
              "apiVersion": "ceph.rook.io/v1",
              "kind": "CephObjectStoreUser",
              "metadata": {
                  "name": "my-user",
                  "namespace": "my-rook-ceph"
              },
              "spec": {
                  "store": "my-store",
                  "displayName": "my display name"
              }{{end}}
          }
      ]
    capabilities: Basic Install
  name: ocs-operator.v{{.CsvVersion}}
  namespace: placeholder
spec:
  apiservicedefinitions: {}
  customresourcedefinitions:
    owned:
    - kind: StorageCluster
      name: storageclusters.ocs.openshift.io
      version: v1alpha1
      displayName: Storage Cluster
      description: Storage Cluster represents a Rook Ceph storage cluster including all the storage and compute resources required.
    - description: Represents a Ceph cluster.
      displayName: Ceph Cluster
      kind: CephCluster
      name: cephclusters.ceph.rook.io
      version: v1
{{if .Converged}}
    - description: Represents a Ceph Block Pool.
      displayName: Ceph Block Pool
      kind: {{(index .RCO.CRDs "cephblockpools.ceph.rook.io").Spec.Names.Kind}}
      name: {{(index .RCO.CRDs "cephblockpools.ceph.rook.io").ObjectMeta.Name}}
      version: {{(index .RCO.CRDs "cephblockpools.ceph.rook.io").Spec.Version}}
    - description: Represents a Ceph Object Store.
      displayName: Ceph Object Store
      kind: {{(index .RCO.CRDs "cephobjectstores.ceph.rook.io").Spec.Names.Kind}}
      name: {{(index .RCO.CRDs "cephobjectstores.ceph.rook.io").ObjectMeta.Name}}
      version: {{(index .RCO.CRDs "cephobjectstores.ceph.rook.io").Spec.Version}}
    - description: Represents a Ceph Object Store User.
      displayName: Ceph Object Store User
      kind: {{(index .RCO.CRDs "cephobjectstoreusers.ceph.rook.io").Spec.Names.Kind}}
      name: {{(index .RCO.CRDs "cephobjectstoreusers.ceph.rook.io").ObjectMeta.Name}}
      version: {{(index .RCO.CRDs "cephobjectstoreusers.ceph.rook.io").Spec.Version}}
{{end}}
  description: |
    Red Hat Openshift Container Storage (OCS) provides hyperconverged storage for applications within an Openshift cluster.
    The OCS operator is the primary operator for Red Hat OpenShift Container Storage (OCS). It serves to facilitate the other operators in OCS by performing administrative tasks outside their scope as well as watching and configuring their CustomResources.
  displayName: Openshift Container Storage Operator
  install:
    spec:
      deployments:
      - name: ocs-operator
        spec:
{{.OCS.DeploymentSpec}}
{{if .Converged}}
      - name: rook-ceph-operator
        spec:
{{.RCO.DeploymentSpec}}
{{end}}
      permissions:
        - serviceAccountName: ocs-operator
          rules:
{{index .OCS.RoleRules "ocs-operator"}}
{{if .Converged}}
{{ range $key, $value := .RCO.RoleRules }}
        - serviceAccountName: {{$key}}
          rules:
{{$value}}
{{end}}
{{end}}
{{if .Converged}}
      clusterPermissions:
{{ range $key, $value := .RCO.ClusterRoleRules }}
        - serviceAccountName: {{$key}}
          rules:
{{$value}}
{{end}}
{{end}}
    strategy: deployment
  installModes:
  - supported: true
    type: OwnNamespace
  - supported: true
    type: SingleNamespace
  - supported: false
    type: MultiNamespace
  - supported: false
    type: AllNamespaces
  maturity: alpha
  version: {{.CsvVersion}}{{if .Replaces}}
  replaces: ocs-operator.v{{.ReplacesVersion}}{{end}}
  minKubeVersion: v1.13.0
  provider:
    name: Red Hat
  maintainers:
  - name: Jose Riviera
    email: jarrpa@redhat.com
  links:
  - name: Source Code
    url: https://github.com/openshift/ocs-operator
  keywords:
  - storage
  - rook
  - ceph
  - block storage
  - shared filesystem
